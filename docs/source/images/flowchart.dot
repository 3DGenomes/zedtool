digraph ZedToolFlow {
    rankdir=TB;
    node [shape=box, style=rounded, fontsize=11, fontname="Helvetica"];

    # --- Preprocess ---
    subgraph cluster_preprocess {
        label = "Pre-process";
        fontsize=14;
        fontname="Helvetica-Bold";
        style="filled,rounded";        
        color=black;
        fillcolor="#e6f2ff";  # pale blue

        preprocess [label=<
            <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="1">
                <TR><TD ALIGN="LEFT">Merge experiments</TD></TR>
                <TR><TD ALIGN="LEFT">Apply pre-made drift correction</TD></TR>
                <TR><TD ALIGN="LEFT">Filter detections</TD></TR>
                <TR><TD ALIGN="LEFT">Locate fiducial markers</TD></TR>
                <TR><TD ALIGN="LEFT">Filter fiducial markers</TD></TR>
            </TABLE>
        >, shape=box, style=rounded];
    }

    subgraph cluster_plots_pre {
        label = "Plots (Pre-correction)";
        fontsize=14;
        fontname="Helvetica-Bold";
        style="filled,rounded";        
        color=black;
        fillcolor="#fff0f5";  # pale pink

        plots_pre [label=<
            <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="1">
                <TR><TD ALIGN="LEFT">Plot detections</TD></TR>
                <TR><TD ALIGN="LEFT">Plot fiducial quality metrics</TD></TR>
                <TR><TD ALIGN="LEFT">Plot fiducial correlations</TD></TR>
                <TR><TD ALIGN="LEFT">Plot fiducials</TD></TR>
                <TR><TD ALIGN="LEFT">Plot summary statistics</TD></TR>
                <TR><TD ALIGN="LEFT">Plot time-point quality metrics</TD></TR>
            </TABLE>
        >];
    }

    subgraph cluster_corrections {
        label = "Corrections";
        fontsize=14;
        fontname="Helvetica-Bold";
        style="filled,rounded";        
        color=black;
        fillcolor="#eaf7ea";  # pale green

        corrections [label=<
            <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="1">
                <TR><TD ALIGN="LEFT">Rotation correct detections</TD></TR>
                <TR><TD ALIGN="LEFT">Drift correct detections</TD></TR>
                <TR><TD ALIGN="LEFT">&Delta; z correct detections</TD></TR>
            </TABLE>
        >];
    }

    subgraph cluster_plots_post {
        label = "Plots (Post-correction)";
        fontsize=14;
        fontname="Helvetica-Bold";
        style="filled,rounded";        
        color=black;
        fillcolor="#fff0f5";  # pale pink

        plots_post [label=<
            <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="1">
                <TR><TD ALIGN="LEFT">Plot detections</TD></TR>
                <TR><TD ALIGN="LEFT">Plot fiducial quality metrics</TD></TR>
                <TR><TD ALIGN="LEFT">Plot fiducial correlations</TD></TR>
                <TR><TD ALIGN="LEFT">Plot fiducials</TD></TR>
                <TR><TD ALIGN="LEFT">Plot summary statistics</TD></TR>
                <TR><TD ALIGN="LEFT">Plot time-point quality metrics</TD></TR>
            </TABLE>
        >];
    }

    # Flow arrows
    preprocess -> plots_pre -> corrections -> plots_post;
}

